<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kuzuro.shop.mappers.shopMapper">
	
	<!-- 카테고리별 상품 리스트 : 1차 분류-->
	<select id="list_1" resultType="com.kuzuro.shop.admin.domain.GoodsViewVO">
		SELECT		gdsNum, gdsName, g.cateCode, c.cateName, c.cateCodeRef, 
					gdsPrice, gdsStock, gdsDes, gdsDate,
					gdsImg, gdsThumbImg
		FROM		tbl_goods g
		INNER JOIN  tbl_goods_category c ON g.cateCode = c.cateCode
		WHERE		g.cateCode = #{cateCode}
		OR 			cateCodeRef = #{cateCode}
	</select>
	
	<!-- 카테고리별 상품 리스트 : 2차 분류 -->
	<select id="list_2" resultType="com.kuzuro.shop.admin.domain.GoodsViewVO">
		SELECT		gdsNum, gdsName, g.cateCode, c.cateName, c.cateCodeRef, 
					gdsPrice, gdsStock, gdsDes, gdsDate,
					gdsImg, gdsThumbImg
		FROM		tbl_goods g
		INNER JOIN  tbl_goods_category c ON g.cateCode = c.cateCode
		WHERE		g.cateCode = #{cateCode}
	</select>
	
	<!-- 상품 소감(댓글) 작성 -->
	<insert id="registReply">
		INSERT INTO tbl_reply (gdsNum, userId, repNum, repCon)
		VALUES (#{gdsNum}, #{userId}, nextval(tbl_reply_seq) , #{repCon});
	</insert>
	
	<!-- 상품 소감(댓글) 리스트 조회 -->
	<select id="replyList" resultType="com.kuzuro.shop.shop.domain.ReplyListVO">
		SELECT 	gdsNum, r.userId, m.userName, repNum, repCon, r.repDate
		FROM		tbl_reply r
		INNER JOIN tbl_member m ON r.userId = m.userId
		WHERE 	gdsNum = #{gdsNum}
		ORDER BY repNum DESC
	</select>
</mapper>

